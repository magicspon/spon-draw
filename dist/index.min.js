!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.sponDown=t()}(this,function(){"use strict";var n=function(n,t){var i=!1;return new Promise(function(e){t.addEventListener(n,function e(o,s){if(s.stopPropagation(),t.removeEventListener(n,e),s.target===t&&!i)return i=!0,void o()}.bind(null,e),!1)})},t=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(n[e]=i[e])}return n};function i(n){if(Array.isArray(n)){for(var t=0,i=Array(n.length);t<n.length;t++)i[t]=n[t];return i}return Array.from(n)}return function e(){var o,s=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaults={openButton:"[data-menu-opener]",overlay:document.getElementById("site-menu"),contents:document.getElementById("menu-inner"),closeButton:"[data-menu-closer]",init:!1,buttonActiveClass:"is-active",overlayVisibleClass:"is-visible",overlayAnimationClass:"is-animating",transition:!0,animationType:"transition",before:null},this.isVisible=!1,this.isAnimating=!1,this.isInitialized=!1,this.setOptions=function(n){return s.options=t({},s.options,n),s},this._before=function(n){var t=s.options.before;return"function"==typeof t?new Promise(function(i){t(n,i)}):Promise.resolve()},this.addEvents=function(){var n=s.dom,t=n.openButton,i=n.closeButton,e=n.contents;return t.forEach(function(n){n.addEventListener("click",s.onClick),n.addEventListener("touchstart",s.onClick)}),i.forEach(function(n){n.addEventListener("click",s.onClick),n.addEventListener("touchstart",s.onClick)}),e&&e.addEventListener("click",s.blockClicks),s},this.removeEvents=function(){var n=s.dom,t=n.openButton,i=n.closeButton,e=n.contents;return t.forEach(function(n){n.removeEventListener("click",s.onClick),n.removeEventListener("touchstart",s.onClick)}),i.forEach(function(n){n.removeEventListener("click",s.onClick),n.removeEventListener("touchstart",s.onClick)}),e&&e.removeEventListener("click",s.blockClicks),s},this.onClick=function(n){n.preventDefault(),s.isAnimating||(s.isAnimating=!0,s.isVisible||(s.initialFocus=n.target),s._before({event:n,state:s.isVisible,dom:s.dom}).then(function(){s.isVisible?s.close():s.open()}))},this.blockClicks=function(n){n.stopPropagation()},this.open=function(){var t=s.options,i=t.buttonActiveClass,e=t.overlayVisibleClass,o=t.overlayAnimationClass,a=t.transition,r=s.dom,c=r.overlay,l=r.openButton;return s.emit("open",{dom:s.dom}),l.forEach(function(n){return n.classList.add(i)}),c.classList.add(e),a?(c.classList.add(o),n(s.animationEndEvents,c).then(s.onTransitionEnd)):(s.isVisible=!0,s.isAnimating=!1),s},this.close=function(){var t=s.dom.overlay,i=s.options.transition;return s.emit("close",{dom:s.dom}),s.reset(),i?n(s.animationEndEvents,t).then(s.onTransitionEnd):(s.isVisible=!1,s.isAnimating=!1),s},this.reset=function(){var n=s.options,t=n.buttonActiveClass,i=n.overlayAnimationClass,e=n.overlayVisibleClass,o=s.dom,a=o.overlay;o.openButton.forEach(function(n){return n.classList.remove(t)}),a.classList.remove(i),a.classList.remove(e)},this.onTransitionEnd=function(){var n=s.dom.overlay,t=s.options.overlayAnimationClass;s.isVisible=!s.isVisible,s.isAnimating=!1;var i=s.isVisible?"after:open":"after:close";s.emit(i,{dom:s.dom,state:s.isVisible}),n.classList.remove(t)},this.destroy=function(){if(s.isInitialized)return s.isInitialized=!1,s.isVisible=!1,s.isAnimating=!1,s.reset(),s.removeEvents(),s},this.init=function(){if(!s.isInitialized){s.isInitialized=!0;var n=s.options,t=n.contents,e=n.overlay,o=n.openButton,a=n.closeButton,r=n.animationType;return s.animationEndEvents=function(n){var t=void 0;t=!n||"transition"!==n&&"trans"!==n?{OAnimation:"oAnimationEnd",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",animation:"animationend"}:{OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};var i=document.createElement("fake");return Object.keys(t).reduce(function(n,e){return void 0!==i.style[e]?t[e]:n},"")}(r),s.dom={html:document.getElementsByTagName("html")[0],body:document.body,openButton:[].concat(i(document.querySelectorAll(o))),closeButton:[].concat(i(document.querySelectorAll(a))),overlay:e,contents:t},s.addEvents(),s}},this.options=t({},this.defaults,a),this.options.init&&this.init(),Object.assign(this,(o=o||Object.create(null),{on:function(n,t){(o[n]||(o[n]=[])).push(t)},off:function(n,t){o[n]&&o[n].splice(o[n].indexOf(t)>>>0,1)},emit:function(n,t){(o[n]||[]).slice().map(function(n){n(t)}),(o["*"]||[]).slice().map(function(i){i(n,t)})}}))}});
